{"version":3,"file":"CampaignBuilder-YSCHIWP5.js","sources":["../../src/pages/CampaignBuilder.jsx"],"sourcesContent":["// frontend/src/pages/CampaignBuilder.jsx\nimport React, { useState } from 'react';\nimport { useAuth } from '../contexts/AuthContext';\nimport { useCampaign } from '../contexts/CampaignContext';\nimport { useNavigate } from 'react-router-dom';\nimport { db } from '../firebase';\nimport { doc, setDoc, serverTimestamp } from 'firebase/firestore';\n\nexport default function CampaignBuilder() {\n  const { user: currentUser } = useAuth();\n  if (!currentUser) {\n    return <div className=\"p-4 text-center text-gray-600\">Loading your profileâ€¦</div>;\n  }\n  const userId = currentUser.uid;\n  console.log(\"[CampaignBuilder] currentUser:\", currentUser);\n  const { updateCampaignData } = useCampaign();\n  const navigate = useNavigate();\n\n  const [messages, setMessages] = useState([]);\n  const [input, setInput] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n  const chatRef = React.useRef(null);\n\n  const sendMessage = async () => {\n    if (!input.trim()) return;\n\n    const userMessage = { role: 'user', content: input.trim() };\n    const newMessages = [...messages, userMessage];\n    setMessages(newMessages);\n    setLoading(true);\n    setError('');\n\n    try {\n      const response = await fetch('/api/campaign-assistant', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ input: input.trim(), history: newMessages }),\n      });\n\n      const data = await response.json();\n      const aiMessage = { role: 'assistant', content: data.aiMessage };\n      setMessages((prev) => [...prev, aiMessage]);\n      setTimeout(() => chatRef.current?.scrollTo(0, chatRef.current.scrollHeight), 100);\n\n      if (data.done && data.structured) {\n        const classificationRes = await fetch('/api/classify-campaign-type', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({ summary: data }),\n        });\n\n        const { match } = await classificationRes.json();\n        const campaignRecord = {\n          userId: userId,\n          summary: data,\n          classification: match,\n          createdAt: serverTimestamp(),\n        };\n\n        await setDoc(doc(db, 'campaigns', currentUser.uid), campaignRecord);\n        updateCampaignData(campaignRecord);\n        navigate('/campaign/next-steps');\n      }\n    } catch (err) {\n      console.error('Error:', err);\n      setError('Something went wrong. Please try again.');\n    } finally {\n      setInput('');\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"p-4 max-w-3xl mx-auto\">\n      <h2 className=\"text-2xl font-bold mb-4\">Describe Your Campaign</h2>\n\n      <div className=\"border rounded p-4 mb-4 bg-gray-50 max-h-[50vh] overflow-y-auto\" ref={chatRef}>\n        {messages.map((msg, i) => (\n          <div key={i} className={`mb-2 ${msg.role === 'user' ? 'text-right' : 'text-left'}`}>\n            <span className={`inline-block px-4 py-2 rounded-lg shadow max-w-[80%] ${msg.role === 'user' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-black'}`}>\n              {msg.content}\n            </span>\n          </div>\n        ))}\n      </div>\n\n      <textarea\n        rows={3}\n        className=\"w-full border rounded p-2 mb-2\"\n        placeholder=\"Type your message...\"\n        value={input}\n        onChange={(e) => setInput(e.target.value)}\n        onKeyDown={(e) => { if (e.key === \"Enter\" && !e.shiftKey) { e.preventDefault(); sendMessage(); } }}\n        disabled={loading}\n      />\n\n      <button\n        onClick={sendMessage}\n        className=\"w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700\"\n        disabled={loading}\n      >\n        {loading ? 'Thinking...' : 'Send'}\n      </button>\n\n      {error && <p className=\"mt-2 text-red-600\">{error}</p>}\n    </div>\n  );\n}\n"],"names":["CampaignBuilder","currentUser","useAuth","jsx","userId","updateCampaignData","useCampaign","navigate","useNavigate","messages","setMessages","useState","input","setInput","loading","setLoading","error","setError","chatRef","React","sendMessage","userMessage","newMessages","data","aiMessage","prev","_a","classificationRes","match","campaignRecord","serverTimestamp","setDoc","doc","db","err","jsxs","msg","i"],"mappings":"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"}